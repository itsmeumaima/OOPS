{% extends "core/base.html" %}

{% block title %}Color Corrector - Vision Accessibility Tools{% endblock %}

{% block content %}
<div class="max-w-6xl mx-auto">
  <!-- Header Section -->
  <div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <div class="flex justify-between items-center">
      <h2 class="text-2xl font-bold text-neutral-900 flex items-center gap-2">
        <i class="fas fa-palette text-primary-600"></i>
        Color Corrector
      </h2>
      <a href="{% url 'dashboard' %}" class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-medium rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
        <i class="fas fa-arrow-left mr-2"></i>
        <span>Back to Dashboard</span>
      </a>
    </div>
  </div>

  <!-- Form Section -->
  <div class="bg-white rounded-xl shadow-md p-6 mb-8">
    <form method="post" enctype="multipart/form-data" id="colorCorrectorForm">
      {% csrf_token %}
      
      <div class="mb-6">
        <label for="id_image" class="block text-sm font-medium text-neutral-700 mb-2">Choose image</label>
        {{ form.image }}
      </div>

      <div class="mb-6">
        <label class="block text-sm font-medium text-neutral-700 mb-2">Correction type</label>
        <div class="mt-2 space-y-2">
          {{ form.correction_type }}
        </div>
      </div>

      <div class="mb-8">
        <label for="id_hue" class="block text-sm font-medium text-neutral-700 mb-2">Hue adjustment</label>
        <div class="flex items-center">
          {{ form.hue }}
          <span class="hue-value ml-3 text-primary-600 font-medium" id="hue_val">{{ form.hue.value|default:0 }}</span>
        </div>
      </div>

      <div class="text-center">
        <button type="submit" class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-medium rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
          <i class="fas fa-magic mr-2"></i>
          <span>Apply Correction</span>
        </button>
      </div>
    </form>
  </div>

  {% if corrected_image_url %}
  <!-- Result Section -->
  <div class="bg-white rounded-xl shadow-md p-6">
    <h3 class="text-xl font-bold text-neutral-900 mb-6 text-center flex items-center justify-center gap-2">
      <i class="fas fa-image text-primary-600"></i>
      Correction Results
    </h3>
    
    <div class="flex flex-col md:flex-row gap-8 justify-center">
      <div class="flex-1 max-w-md">
        <div class="text-center">
          <img src="{{ original_image_url }}" alt="original" class="w-full h-auto rounded-lg shadow-md mb-3">
          <p class="text-lg font-semibold text-primary-600">Original Image</p>
        </div>
      </div>
      
      <div class="flex-1 max-w-md">
        <div class="text-center">
          <img src="{{ corrected_image_url }}" alt="corrected" class="w-full h-auto rounded-lg shadow-md mb-3">
          <p class="text-lg font-semibold text-accent-600">Corrected Image</p>
        </div>
      </div>
    </div>
    
    <div class="text-center mt-8">
      <a href="{% url 'corrector' %}" class="inline-flex items-center px-5 py-2.5 bg-gradient-to-r from-primary-600 to-primary-700 hover:from-primary-700 hover:to-primary-800 text-white font-medium rounded-lg shadow-md hover:shadow-lg transform hover:-translate-y-0.5 transition-all duration-300">
        <i class="fas fa-redo mr-2"></i>
        <span>Correct Another Image</span>
      </a>
    </div>
  </div>
  {% endif %}
</div>

<style>
  input[type="file"] {
    display: block;
    width: 100%;
    padding: 0.5rem 1rem;
    font-size: 1rem;
    line-height: 1.5;
    color: #495057;
    background-color: #fff;
    background-clip: padding-box;
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
  }
  
  input[type="file"]:focus {
    color: #495057;
    background-color: #fff;
    border-color: #0ea5e9;
    outline: 0;
    box-shadow: 0 0 0 0.25rem rgba(14, 165, 233, 0.25);
  }
  
  input[type="range"] {
    width: 100%;
    height: 0.5rem;
    background: #e2e8f0;
    border-radius: 0.25rem;
    outline: none;
    -webkit-appearance: none;
  }
  
  input[type="range"]::-webkit-slider-thumb {
    -webkit-appearance: none;
    appearance: none;
    width: 1.25rem;
    height: 1.25rem;
    background: #0ea5e9;
    border-radius: 50%;
    cursor: pointer;
  }
  
  input[type="range"]::-moz-range-thumb {
    width: 1.25rem;
    height: 1.25rem;
    background: #0ea5e9;
    border-radius: 50%;
    cursor: pointer;
    border: none;
  }
  
  .hue-value {
    min-width: 40px;
    text-align: center;
    font-weight: 600;
  }
</style>

<script>
  const hueInput = document.getElementById('id_hue');
  const hueVal = document.getElementById('hue_val');
  if (hueInput) {
    hueInput.addEventListener('input', function() {
      hueVal.textContent = this.value;
    });
  }
  
  // Add form-control class to Django form field
  document.addEventListener('DOMContentLoaded', function() {
    const imageInput = document.querySelector('input[type="file"]');
    if (imageInput) {
      imageInput.classList.add('form-control');
    }
    
    // Style radio buttons
    const radioButtons = document.querySelectorAll('input[type="radio"]');
    radioButtons.forEach(radio => {
      radio.classList.add('form-check-input');
    });
    
    // Style range input
    const rangeInput = document.querySelector('input[type="range"]');
    if (rangeInput) {
      rangeInput.classList.add('form-range');
    }
    
    // Add labels to radio buttons
    const correctionTypeLabels = document.querySelectorAll('#id_correction_type label');
    correctionTypeLabels.forEach(label => {
      label.classList.add('form-check-label', 'me-3');
    });
    
    // Add form-check class to radio containers
    const correctionTypeDivs = document.querySelectorAll('#id_correction_type div');
    correctionTypeDivs.forEach(div => {
      div.classList.add('form-check', 'form-check-inline');
    });
  });
  
  // Show loading indicator when form is submitted
  const form = document.getElementById('colorCorrectorForm');
  if (form) {
    form.addEventListener('submit', function() {
      // Create loading indicator if it doesn't exist
      if (!document.getElementById('loadingIndicator')) {
        const loadingDiv = document.createElement('div');
        loadingDiv.id = 'loadingIndicator';
        loadingDiv.className = 'loading';
        loadingDiv.innerHTML = `
          <div class="flex flex-col items-center justify-center py-4">
            <div class="animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600 mb-2"></div>
            <p class="text-neutral-700">Processing your image...</p>
          </div>
        `;
        form.appendChild(loadingDiv);
      }
      
      // Show loading indicator
      document.getElementById('loadingIndicator').style.display = 'block';
      
      // Disable submit button to prevent multiple submissions
      const submitButton = form.querySelector('button[type="submit"]');
      submitButton.disabled = true;
      submitButton.innerHTML = '<span class="animate-spin h-4 w-4 mr-2 border-t-2 border-b-2 border-white rounded-full inline-block"></span>Processing...';
    });
  }
</script>
{% endblock %}